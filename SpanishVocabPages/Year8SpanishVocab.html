<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Year 7 Spanish Vocabulary Practice</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        * { -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .navbar {
            background: #DD1F25;
            color: white;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 1px;
            box-shadow: 0 2px 12px rgba(221, 31, 37, 0.15);
        }

        .navbar a {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            margin-right: 25px;
            transition: all 0.2s ease;
            padding: 6px 12px;
            border-radius: 4px;
        }

        .navbar a:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-3px);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #DD1F25;
            text-align: center;
            margin-bottom: 40px;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 14px rgba(221, 31, 37, 0.09);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #DD1F25;
            margin-bottom: 20px;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .module-btn, .week-btn {
            background: rgba(221, 31, 37, 0.05);
            border: 2px solid #DD1F25;
            color: #DD1F25;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .module-btn:hover, .week-btn:hover {
            background: #DD1F25;
            color: white;
            transform: translateY(-1px);
        }

        /* Disable hover on touch devices */
        @media (hover: none) {
            .module-btn:hover, .week-btn:hover {
                background: rgba(221, 31, 37, 0.05);
                color: #DD1F25;
                transform: none;
            }
            .module-btn.selected:hover, .week-btn.selected:hover {
                background: #DD1F25;
                color: white;
            }
            .module-btn.has-selections:hover {
                background: rgba(221, 31, 37, 0.23);
                color: #DD1F25;
            }
        }

        .module-btn.selected, .week-btn.selected {
            background: #DD1F25;
            color: white;
        }

        .module-btn.selected:hover, .week-btn.selected:hover {
            background: #c11a1f;
        }

        .module-btn.has-selections {
            background: rgba(221, 31, 37, 0.23);
            border-color: #DD1F25;
            color: #DD1F25;
            font-weight: 700;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .setting-card {
            background: #f8f8f8;
            border-radius: 8px;
            padding: 20px;
        }

        .setting-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: block;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 8px;
            background: white;
            border: 2px solid #e0e0e0;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: #DD1F25;
            background: rgba(221, 31, 37, 0.02);
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #DD1F25;
        }

        .radio-option input[type="radio"]:checked + span {
            color: #DD1F25;
            font-weight: 600;
        }

        .radio-option:has(input[type="radio"]:checked) {
            border-color: #DD1F25;
            background: rgba(221, 31, 37, 0.05);
        }

        .start-btn {
            background: #DD1F25;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: all 0.3s;
        }

        .start-btn:hover {
            background: #c11a1f;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(221, 31, 37, 0.3);
        }

        .start-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Test Interface */
        .test-container {
            display: none;
        }

        .test-container.active {
            display: block;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-to-setup-btn {
            background: #DD1F25;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-to-setup-btn:hover {
            background: #c11a1f;
            transform: translateX(-3px);
        }

        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: #DD1F25;
            height: 100%;
            transition: width 0.3s;
        }

        .flashcard {
            background: white;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 6px 24px rgba(221, 31, 37, 0.15);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .flashcard:hover {
            transform: scale(1.02);
        }

        .flashcard-question {
            font-size: 2rem;
            font-weight: 700;
            color: #DD1F25;
            margin-bottom: 20px;
        }

        .flashcard-answer {
            font-size: 1.5rem;
            color: #666;
            display: none;
        }

        .flashcard.revealed .flashcard-answer {
            display: block;
        }

        .typing-test {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 6px 24px rgba(221, 31, 37, 0.15);
        }

        .typing-question {
            font-size: 1.8rem;
            font-weight: 700;
            color: #DD1F25;
            margin-bottom: 30px;
            text-align: center;
        }

        .typing-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #DD1F25;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .submit-btn {
            background: #DD1F25;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            background: #c11a1f;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .next-btn {
            background: #DD1F25;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s;
        }

        .next-btn:hover {
            background: #c11a1f;
        }

        .results {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 6px 24px rgba(221, 31, 37, 0.15);
        }

        .results-title {
            font-size: 2rem;
            font-weight: 700;
            color: #DD1F25;
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="../spanish-vocab.html">← Back</a>
        Year 7 Spanish Vocabulary Practice
    </div>

    <div class="container">
        <!-- Setup Interface -->
        <div id="setupInterface">
            <h1 class="page-title">Vocabulary Practice</h1>

            <div class="section">
                <h2 class="section-title">Select Modules</h2>
                <div class="module-grid" id="moduleSelection"></div>
            </div>

            <div class="section" id="weekSection" style="display: none;">
                <h2 class="section-title">Select Weeks</h2>
                <div class="module-grid" id="weekSelection"></div>
            </div>

            <div class="section">
                <h2 class="section-title">Test Settings</h2>
                <div class="settings-grid">
                    <div class="setting-card">
                        <label class="setting-label">Direction</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="direction" value="es-en" checked>
                                <span>Spanish → English</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="direction" value="en-es">
                                <span>English → Spanish</span>
                            </label>
                        </div>
                    </div>
                    <div class="setting-card">
                        <label class="setting-label">Mode</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="mode" value="flashcards" checked>
                                <span>Flashcards</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="mode" value="typing">
                                <span>Type Answers</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <button class="start-btn" id="startBtn" disabled>Start Practice</button>
        </div>

        <!-- Test Interface -->
        <div class="test-container" id="testInterface">
            <div class="test-header">
                <button class="back-to-setup-btn" onclick="backToSetup()">
                    <span>←</span>
                    <span>Back to Year 7 Vocab</span>
                </button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="testContent"></div>
        </div>
    </div>

    <script>
        // Vocabulary Data Structure
        const VOCAB_DATA = `
Module 1:
Week 1:

Soy - I am (+ description)
Estoy - I am (+ location)
Tengo - I have
Voy - I go 
Juego - I play 
Hago - I do/make 
Es - It is 
Son - They are 
Vivo - I live 
Estudio - I study 
Me gusta(n) - I like 
Me encanta(n) - I love 
Voy a jugar - I am going to play 
Voy a tener - I am going to have 
Voy a hacer - I am going to do 

Week 2:

¿Adónde fuiste de vacaciones? - Where did you go on holiday?
El año pasado - Last year 
El verano pasado - Last summer 
Fui a Escocia - I went to Scotland 
...a España - To Spain 
...a Grecia - To Greece 
...a Francia - To France 
...a los Estados Unidos - To the United States  
...a Turquía - To Turkey 
¿Con quién fuiste? - Who did you go with? 
Fui con mi familia - I went with my family 
...con mi clase - with my class 
...con mis padres - with my parents 
...con mi mejor amigo/a - with my best friend 
...solo/a - alone 

Week 3:

Fui - I went 
Fuiste - You went 
Fue - He/She/It went 
Fuimos - We went 
Fuisteis - You(pl) went 
Fueron - They went 
¿Cómo fuiste? - How did you go?
Fui en avión - I went by plane 
...en barco - By boat 
...en coche - by car 
...en tren - by train 
...en autocar - by coach
...en autobús - by bus 
...en bicicleta - by bike 
...a pie - by foot 

Week 4:

¿Qué hiciste en tus vacaciones? - What did you do on your holiday?
Visité monumentos - I visited monuments
Compré una camiseta - I bought a T-shirt 
Saqué fotos - I took photos
Monté una bicicleta - I rode a bike 
Descansé en la playa - I rested on the beach 
Mandé SMS/mensajes - I sent text messages 
Bailé - I danced
Nadé en el mar - I swam in the sea
Tomé el sol - I sunbathed
El primer día - On the first day
Luego - Then
Después - After
Después - Afterwards
¡Qué genial! - How cool!

Week 5:


¿Qué hiciste? - What did you do?
Comí paella - I ate paella 
Salí con mi amigo/a - I went out with my friend 
Escribí SMS/mensajes - I wrote text messages 
Vi un castillo - I saw a castle 
Conocí a un(a) chico/a guapo/a - I met a good looking boy/girl 
Por la mañana - In the morning 
Por la tarde - In the afternoon 
Comí - I ate 
Comiste - You ate 
Comió - He/She ate 
Comimos - We ate 
Comisteis - You(pl) ate 
Comieron - They ate 
¡Qué aburrido! - How boring!

Week 6:

¿Cómo te fue? - How did it go (for you)?
Fue guay - It was cool 
Fue raro - It was strange 
Fue regular - It was so-so 
Fue un desastre - It was a disaster 
Fue horrible - It was horrible 
Fue divertido - It was fun 
Fue flipante - It was amazing 
Fue genial - It was great 
Fue horroroso - It was dreadful
¿Por qué? - Why?
¿Adónde fuiste de vacaciones? - Where did you go on holiday?
¿Con quién fuiste? - Who did you go with? 
¿Cómo fuiste? - How did you go? 
¿Qué hiciste? - What did you do? 

Module 2:
Week 1:

¿Qué haces con tu móvil? - What do you do with your mobile?
Todos los días - Every day
Saco fotos - I take photos
Hablo por WhatsApp - I talk on WhatsApp
Mando SMS / mensajes - I send text messages
Juego - I play
Leo mis SMS - I read my text messages
Escucho música - I listen to music
Descargo música - I download music
Descargo melodías - I download ringtones/tunes
Descargo aplicaciones - I download apps
Chateo con mis amigos - I chat with my friends
Comparto vídeos - I share videos
Veo vídeos - I watch videos
Veo películas - I watch films
¿Hablas con tus amigos? - Do you talk with your friends?


Week 2:

Dos o tres veces a la semana - Two or three times a week
A veces - Sometimes
De vez en cuando - From time to time
Nunca - Never
¿Qué hay en la foto? - What is there in the photo?
En la foto hay... - In the photo there is/are...
Un chico / una chica - A boy/a girl
Un hombre / una mujer - A man/a woman
Una familia - A family
(Muchas) personas - (Many) people
En el centro - In the centre
A la izquierda - To the left
A la derecha - To the right
Creo que... - I think that...

Week 3:

¿Qué tipo de música te gusta? - What type of music do you like?
Me gusta... - I like...
Me gusta mucho... - I really like...
Me encanta... - I love...
El rap - Rap music
El rock - Rock music
El R’n’B - R’n’B
La música electrónica - Electronic music
La música clásica - Classical music
La música de... - ...'s music
Escucho de todo - I listen to everything
Mi canción favorita es... - My favourite song is...
Mi grupo favorito es... - My favourite group is...
La letra - The lyrics
El ritmo - The rhythm / beat

Week 4:
¿Qué tipo de programa te gusta? - What type of programme do you like?
Prefiero... - I prefer...
Los programas de deportes - Sports programmes
Los reality - Reality TV shows
Los concursos - Game shows
Los documentales - Documentaries
Las comedias - Comedies
Las series policíacas - Police series
Las telenovelas - Soap operas
Los telediarios - News programmes
Informativo/a - Informative
Interesante - Interesting
Mi programa favorito es... - My favourite programme is...
Es más divertido/a que... - It is more fun than...
Son más emocionantes que... - They are more exciting than...

Week 5:

¿Qué hiciste ayer? - What did you do yesterday?
Ayer - Yesterday
Por la mañana - In the morning
Por la tarde - In the afternoon
Hice kárate - I did karate
Monté en bici - I rode a bike
Jugué en línea - I played online
Vi una película - I watched a film
Hice gimnasia - I did gymnastics
Hablé por Skype - I spoke on Skype
Hice los deberes - I did my homework
Bailé - I danced
Salí con mis amigos/as - I went out with my friends
Luego - Then
Un poco más tarde - A bit later

Module 3:
Week 1:

¿Qué te gusta comer? - What do you like to eat?
¿Qué te gusta beber? - What do you like to drink? 
Me gusta(n) - I like... 
El arroz - Rice 
Los huevos - Eggs 
La leche - Milk 
El agua - Water 
La carne - Meat 
Las hamburguesas - Hamburgers  
El marisco - Seafood 
El pescado - Fish  
Los caramelos - Sweets 
El queso - Cheese 
La fruta - Fruit 
Las verduras - Vegetables 

Week 2:

¿Qué desayunas? - What do you have for breakfast?
Desayuno... - I have ... for breakfast 
¿Qué comes? - What do you have for lunch?
Como... - I have ... for lunch 
¿Qué cenas? - What do you have for dinner?
Ceno... - I have ... for dinner 
(los) Cereales - Cereal 
(los) Churros - Churros 
(el) Yogur - Yoghurt 
(las) Tostadas - Toast 
(el) ColaCao - ColaCao (Chocolate milk)
(el) Café - Coffee 
(el) Zumo de naranja - Orange juice  
No desayuno nada - I don't have anything for breakfast 

Week 3:

(la) Paella - Paella 
Un bocadillo - A sandwich 
(el) Pollo - Chicken 
(la) Ensalada - Salad
(el) Pescado - Fish 
(el) Arroz - Rice 
(las) Patatas fritas - Chips/Crisps 
Todos los días - Every day 
Normalmente - Normally 
Solamente - Only
Nunca - Never 
¡Qué rico! - How tasty! 
¡Qué asco! - How disgusting!
¡Ñam, ñam! - Yum, yum! 

Week 4:

En el restaurante - In the restaurant 
¿Qué va a tomar? - What are you going to have? 
¿Qué van a tomar? - What are you(pl) going to have? 
¿Y usted? - And you? 
Voy a tomar... - I am going to have...
También - Also 
Tengo hambre - I am hungry 
Tengo sed - I am thirsty 
De primer plato... - For starter... 
De segundo plato... - For main...
De postre... - For dessert... 
Para beber... - To drink 
¿Algo más? - Anything else? 
No, nada más, gracias - No, nothing else, thank you 
La cuenta, por favor - The bill, please

Module 4:

Week 1:

¿Te gustaría venir a mi casa? - Would you like to come to my house?
Me gustaría... - I would like...
Ir al centro comercial - To go to the shopping centre
Ir al parque - To go to the park
Ir al polideportivo - To go to the sports centre
Ir al museo - To go to the museum
Ir a la bolera - To go to the bowling alley
Ir a la pista de hielo - To go to the ice rink
Vale - Okay
De acuerdo - Agreed
Muy bien - Very well
¡Genial! - Great!
¡Ni hablar! - No way!
¡Ni en sueños! - Not even in your dreams!
No tengo ganas - I don't feel like it

Week 2:

¿Te gustaría ir al cine? - Would you like to go to the cinema?
Sí, me gustaría mucho - Yes, I would really like to
¿Dónde está? - Where is it?
Está - It is
Detrás de... - Behind...
Delante de... - In front of...
Enfrente de... - Opposite...
Al lado de... - Next to...
En... - In...
¿A qué hora? - At what time?
A las seis - At six o'clock
A las dos y cuarto - At quarter past two
A la una y media - At half past one
A las diez menos cuarto - At quarter to ten
¿Dónde quedamos? - Where shall we meet?

Week 3:

¿Quieres salir? - Do you want to go out?
¿Quieres ir a la playa? - Do you want to go to the beach?
Lo siento - Sorry
No puedo - I can't
¿Por qué no? - Why not?
Tengo que... - I have to...
Hacer los deberes - Do homework
Ordenar mi dormitorio - Tidy my room
Pasear al perro - Walk the dog
Lavarme el pelo - Wash my hair
Salir con mis padres - Go out with my parents
Cuidar a mi hermano/a - Look after my brother/sister
No quiero - I don't want to
No tengo dinero - I don't have money
¡Qué rollo! - What a pain!

Week 4:

¿Cómo te preparas? - How do you get ready?
Me ducho - I shower
Me baño - I bathe
Me lavo la cara - I wash my face
Me lavo los dientes - I brush my teeth
Me visto - I get dressed
Me peino - I comb my hair
Me maquillo - I put on makeup
Me pongo gomina - I put on hair gel
Me aliso el pelo - I straighten my hair
Primero - First
Luego - Then
Después - After
Siempre - Always
Finalmente - Finally

Week 5:

¿Qué llevas? - What are you wearing?
¿Qué vas a llevar? - What are you going to wear?
Llevo... - I wear...
Un jersey - A jumper
Un vestido - A dress
Una camiseta - A t-shirt
Una camisa - A shirt
Una falda - A skirt
Una gorra - A cap
Una sudadera - A sweatshirt
Unos pantalones - Some trousers 
Unos vaqueros - Some jeans
Unos zapatos - Some shoes
Unas botas - Some boots
Unas zapatillas de deporte - Some trainers

Week 6:

Llevo - I wear
Llevé - I wore
Voy a llevar - I am going to wear
Como - I eat
Comí - I ate
Voy a comer - I am going to eat
Hago - I do
Hice - I did
Voy a hacer - I am going to do
Juego - I play
Jugué - I played
Voy a jugar - I am going to play
El equipo - The team
El portero - The goalkeeper
El partido - The match

Module 5:

Week 1:
Las casas de vacaciones - Holiday houses
¿Cómo es? - What is it like?
Es un poco grande - It is a bit big
Es bastante moderno - It is quite modern
Es muy antigua - It is very old
Es cómoda - It is comfortable
Tiene... - It has...
...cuatro dormitorios - four bedrooms
...un jacuzzi - a jacuzzi
...dos cuartos de baño - two bathrooms
...un jardín con piscina - a garden with a pool
¿Dónde está? - Where is it?
Está en el centro - It is in the centre
Está en la montaña - It is in the mountains
Está cerca de la playa - It is near the beach

Week 2:

¿Qué se puede hacer? - What can you do?
Se puede(n)... - You can...
...ir de paseo en bicicleta - go for a bike ride
...ir al restaurante - go to the restaurant
...ir a la playa - go to the beach
...visitar un castillo - visit a castle
...jugar al golf - play golf
...ver la catedral - see the cathedral
...hacer senderismo - ...go hiking 
...hacer actividades náuticas - do nautical activities
...ir de compras - ...go shopping
El parque más grande - The biggest park
La playa más bonita - The prettiest beach
Las calles más importantes - The most important streets
También - Also

Week 3:

¿Dónde está? - Where is it?
El parque de atracciones - The theme park
El zoo - The zoo
El minigolf - The miniature golf course
La pista de karting - The go karting track
La catedral - The cathedral
La estación de tren - The train station
Sigue todo recto - Go straight on
Dobla a la derecha - Turn right
Dobla a la izquierda - Turn left
Toma la primera calle a la derecha - Take the first street on the right
Toma la segunda calle a la izquierda - Take the second street on the left
Cruza la plaza - Cross the square
Está a la derecha - It is on the right
Está a la izquierda - It is on the left

Week 4:

Los campamentos de verano - Summer camps
Hacer senderismo - To go hiking
Montar a caballo - To go horse-riding
Ir de pesca - To go fishing
Hacer escalada - To go climbing
Dormir en tiendas (de campaña) - To sleep in tents
Hacer cursos de inglés - To do English courses
Disfrutar de... - To enjoy
Ir de excursión - To go on a trip
Hacer windsurf - To do windsurfing
Hacer vela - To do sailing
Cantar - To sing
Bailar - To dance
Me gustaría - I would like
Me encantaría - I would love

Week 5:

Pues... - Well...
A ver... - Let's see...
No sé... - I don't know...
Depende... - It depends...
Hoy - Today
Ayer - Yesterday
Mañana - Tomorrow
El fin de semana pasado - Last weekend
El año pasado - Last year
Este fin de semana - This weekend
Hace dos años - Two years ago
El año que viene - Next year
Voy - I go
Fui - I went
Voy a ir - I am going to go
`;

        // Parse vocabulary data
        function parseVocabData(text) {
            const modules = {};
            const lines = text.trim().split('\n');
            let currentModule = null;
            let currentWeek = null;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                if (line.startsWith('Module ')) {
                    const moduleNum = line.match(/Module (\d+):/)[1];
                    currentModule = `Module ${moduleNum}`;
                    modules[currentModule] = {};
                } else if (line.startsWith('Week ')) {
                    const weekNum = line.match(/Week (\d+):/)[1];
                    currentWeek = `Week ${weekNum}`;
                    modules[currentModule][currentWeek] = [];
                } else if (line.includes(' - ')) {
                    const [spanish, english] = line.split(' - ').map(s => s.trim());
                    modules[currentModule][currentWeek].push({ spanish, english });
                }
            }

            return modules;
        }

        const vocabData = parseVocabData(VOCAB_DATA);
        let currentModule = null;  // Track currently selected module
        let selectedWeeksByModule = {};  // Store selected weeks for each module
        let testQuestions = [];
        let currentQuestion = 0;
        let correctAnswers = 0;

        // Initialize UI
        function initializeUI() {
            const moduleSelection = document.getElementById('moduleSelection');
            
            Object.keys(vocabData).forEach(module => {
                const btn = document.createElement('button');
                btn.className = 'module-btn';
                btn.textContent = module;
                btn.onclick = () => toggleModule(module, btn);
                moduleSelection.appendChild(btn);
            });
        }

        function toggleModule(module, btn) {
            // Deselect all other module buttons
            const allModuleBtns = document.querySelectorAll('.module-btn');
            allModuleBtns.forEach(b => {
                b.classList.remove('selected');
                // Check if this module has selections and isn't the current one
                const moduleName = b.textContent;
                if (selectedWeeksByModule[moduleName] && selectedWeeksByModule[moduleName].size > 0) {
                    b.classList.add('has-selections');
                } else {
                    b.classList.remove('has-selections');
                }
            });
            
            // Select this module and remove has-selections class (selected takes priority)
            currentModule = module;
            btn.classList.add('selected');
            btn.classList.remove('has-selections');
            
            updateWeekSelection();
            updateStartButton();
        }

        function updateWeekSelection() {
            const weekSection = document.getElementById('weekSection');
            const weekSelection = document.getElementById('weekSelection');
            
            if (!currentModule) {
                weekSection.style.display = 'none';
                return;
            }

            weekSection.style.display = 'block';
            weekSelection.innerHTML = '';

            // Initialize selected weeks for this module if not exists
            if (!selectedWeeksByModule[currentModule]) {
                selectedWeeksByModule[currentModule] = new Set();
            }

            // Show only weeks for the current module
            Object.keys(vocabData[currentModule]).forEach(week => {
                const btn = document.createElement('button');
                btn.className = 'week-btn';
                btn.textContent = `${currentModule} - ${week}`;
                btn.dataset.module = currentModule;
                btn.dataset.week = week;
                
                // Check if this week was previously selected
                const key = `${currentModule}-${week}`;
                if (selectedWeeksByModule[currentModule].has(week)) {
                    btn.classList.add('selected');
                }
                
                btn.onclick = () => toggleWeek(currentModule, week, btn);
                weekSelection.appendChild(btn);
            });
        }

        function toggleWeek(module, week, btn) {
            if (!selectedWeeksByModule[module]) {
                selectedWeeksByModule[module] = new Set();
            }
            
            if (selectedWeeksByModule[module].has(week)) {
                selectedWeeksByModule[module].delete(week);
                btn.classList.remove('selected');
            } else {
                selectedWeeksByModule[module].add(week);
                btn.classList.add('selected');
            }
            
            updateStartButton();
            updateModuleStates();
        }

        function updateModuleStates() {
            // Update all module buttons to show has-selections state
            const allModuleBtns = document.querySelectorAll('.module-btn');
            allModuleBtns.forEach(btn => {
                const moduleName = btn.textContent;
                if ((moduleName !== currentModule) && selectedWeeksByModule[moduleName] && selectedWeeksByModule[moduleName].size > 0) {
                    btn.classList.add('has-selections');
                } else if (moduleName !== currentModule) {
                    btn.classList.remove('has-selections');
                }
            });
        }

        function updateStartButton() {
            const startBtn = document.getElementById('startBtn');
            // Check if any weeks are selected across all modules
            let totalSelected = 0;
            Object.values(selectedWeeksByModule).forEach(weekSet => {
                totalSelected += weekSet.size;
            });
            startBtn.disabled = totalSelected === 0;
        }

        // Test functionality
        function startTest() {
            const direction = document.querySelector('input[name="direction"]:checked').value;
            const mode = document.querySelector('input[name="mode"]:checked').value;

            // Collect questions from all selected weeks across all modules
            testQuestions = [];
            Object.keys(selectedWeeksByModule).forEach(module => {
                selectedWeeksByModule[module].forEach(week => {
                    const vocab = vocabData[module][week];
                    
                    vocab.forEach(item => {
                        testQuestions.push({
                            question: direction === 'es-en' ? item.spanish : item.english,
                            answer: direction === 'es-en' ? item.english : item.spanish,
                            spanish: item.spanish,
                            english: item.english
                        });
                    });
                });
            });

            // Shuffle questions
            testQuestions = testQuestions.sort(() => Math.random() - 0.5);
            currentQuestion = 0;
            correctAnswers = 0;

            // Show test interface
            document.getElementById('setupInterface').style.display = 'none';
            document.getElementById('testInterface').classList.add('active');

            if (mode === 'flashcards') {
                showFlashcard();
            } else {
                showTypingTest();
            }
        }

        function showFlashcard() {
            const testContent = document.getElementById('testContent');
            const question = testQuestions[currentQuestion];
            
            testContent.innerHTML = `
                <div class="flashcard" onclick="this.classList.toggle('revealed')">
                    <div class="flashcard-question">${question.question}</div>
                    <div class="flashcard-answer">${question.answer}</div>
                    <p style="margin-top: 30px; color: #999; font-size: 0.9rem;">Click to reveal answer</p>
                </div>
                <button class="next-btn" onclick="nextQuestion()" style="display: block; margin: 20px auto;">Next</button>
            `;
            
            updateProgress();
        }

        function showTypingTest() {
            const testContent = document.getElementById('testContent');
            const question = testQuestions[currentQuestion];
            
            testContent.innerHTML = `
                <div class="typing-test">
                    <div class="typing-question">${question.question}</div>
                    <input type="text" class="typing-input" id="answerInput" placeholder="Type your answer..." autocomplete="off">
                    <button class="submit-btn" onclick="checkAnswer()">Submit</button>
                    <div id="feedback"></div>
                </div>
            `;
            
            document.getElementById('answerInput').focus();
            document.getElementById('answerInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkAnswer();
            });
            
            updateProgress();
        }

        function normalizeAnswer(text) {
            return text.toLowerCase()
                .trim()
                .replace(/\?/g, '')
                .replace(/¿/g, '')
                .replace(/\!/g, '')
                .replace(/¡/g, '')
                .replace(/\./g, '')
                .replace(/\.\.\./g, '')
                .replace(/\(.*?\)/g, '') // remove parentheses and contents
                .replace(/\[.*?\]/g, '') // remove square brackets and contents
                .replace(/\s+/g, ' ')
                .trim();
        }

        function checkAnswer() {
            const input = document.getElementById('answerInput');
            const feedback = document.getElementById('feedback');
            const userAnswer = normalizeAnswer(input.value);
            const correctAnswer = normalizeAnswer(testQuestions[currentQuestion].answer);
            
            // Handle multiple possible answers separated by /
            const possibleAnswers = correctAnswer.split('/').map(a => normalizeAnswer(a));
            const isCorrect = possibleAnswers.some(ans => userAnswer === ans);
            
            if (isCorrect) {
                correctAnswers++;
                feedback.className = 'feedback correct';
                feedback.innerHTML = `✓ Correct! <br><button class="next-btn" onclick="nextQuestion()">Next</button>`;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `✗ Incorrect. The answer is: ${testQuestions[currentQuestion].answer}<br><button class="next-btn" onclick="nextQuestion()">Next</button>`;
            }
            
            input.disabled = true;
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= testQuestions.length) {
                showResults();
            } else {
                const mode = document.querySelector('input[name="mode"]:checked').value;
                if (mode === 'flashcards') {
                    showFlashcard();
                } else {
                    showTypingTest();
                }
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / testQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showResults() {
            const testContent = document.getElementById('testContent');
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const percentage = Math.round((correctAnswers / testQuestions.length) * 100);
            
            if (mode === 'flashcards') {
                // Flashcard mode - no scoring
                testContent.innerHTML = `
                    <div class="results">
                        <div class="results-title">All Done! 🎉</div>
                        <div style="font-size: 1.3rem; color: #666; margin-bottom: 20px;">
                            You reviewed <strong>${testQuestions.length}</strong> vocabulary items
                        </div>
                        <button class="start-btn" onclick="location.reload()">Start New Practice</button>
                    </div>
                `;
            } else {
                // Typing mode - show score
                testContent.innerHTML = `
                    <div class="results">
                        <div class="results-title">Test Complete!</div>
                        <div class="results-score">${correctAnswers} / ${testQuestions.length}</div>
                        <div style="font-size: 1.5rem; color: #666; margin-bottom: 30px;">${percentage}%</div>
                        <button class="start-btn" onclick="location.reload()">Start New Test</button>
                    </div>
                `;
            }
        }

        function backToSetup() {
            // Hide test interface and show setup interface
            document.getElementById('testInterface').classList.remove('active');
            document.getElementById('setupInterface').style.display = 'block';
            
            // Reset test state
            currentQuestion = 0;
            correctAnswers = 0;
            testQuestions = [];
        }

        // Event listeners
        document.getElementById('startBtn').onclick = startTest;

        // Initialize
        initializeUI();
    </script>
</body>
</html>