<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spanish general resources</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%);
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
        }
        
        /* Navbar with subtle slide-in animation */
        .navbar { 
            background: #DD1F25; 
            color: white; 
            height: 60px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; /* Changed from default */
            padding: 0 30px; 
            font-size: 1.5rem; 
            font-weight: 700; 
            letter-spacing: 1px;
            box-shadow: 0 2px 12px rgba(221, 31, 37, 0.15);
            animation: slideDown 0.5s ease-out;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .navbar a { 
            color: white; 
            text-decoration: none; 
            font-size: 1rem; 
            font-weight: 500; 
            margin-right: 25px;
            transition: all 0.2s ease;
            padding: 6px 12px;
            border-radius: 4px;
            flex-shrink: 0; /* Prevent back button from shrinking */
        }
        
        /* Title element for better control */
        .navbar-title {
            flex: 1 1 auto;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 80px; /* Offset for back button width to center text */
        }
        
        /* Catalogue container with subtle fade-in */
        .catalogue-container { 
            max-width: 1100px; 
            margin: 0 auto; 
            padding: 40px 20px 20px 20px;
            animation: fadeIn 0.6s ease-out 0.1s both;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Search and filter container */
        .search-filter-container {
            max-width: 700px;
            margin: 0 auto 35px auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            animation: scaleIn 0.5s ease-out 0.3s both;
        }
        
        /* Search bar with gentle scale animation */
        .search-bar { 
            width: 100%; 
            max-width: 400px; 
            font-size: 1.1rem; 
            padding: 12px 18px; 
            border-radius: 30px; 
            border: 1px solid #DD1F25; 
            outline: none; 
            box-shadow: 0 2px 12px rgba(221, 31, 37, 0.08); 
            transition: all 0.25s ease;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .search-bar:focus { 
            border-color: #AA151B;
            box-shadow: 0 3px 16px rgba(221, 31, 37, 0.15);
            transform: scale(1.01);
        }
        
        /* Topic filters */
        .topic-filters {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .topic-filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: #444;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            background: #fafafd;
            border: 2px solid #e0e0e0;
            transition: all 0.25s ease;
            user-select: none;
        }
        
        .topic-filter-label:hover {
            border-color: #DD1F25;
            background: #fff5f5;
        }
        
        .topic-filter-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #DD1F25;
        }
        
        .topic-filter-label.active {
            border-color: #DD1F25;
            background: #fff5f5;
            font-weight: 600;
        }
        
        /* Grid with subtle staggered card animations */
        .movies-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
            gap: 15px; 
        }
        
        .movie-card { 
            background: #fafafd; 
            border-radius: 20px; 
            box-shadow: 0 6px 26px rgba(221, 31, 37, 0.08); 
            overflow: hidden; 
            cursor: pointer; 
            display: flex; 
            flex-direction: column; 
            align-items: stretch; 
            text-decoration: none; 
            color: inherit;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px);
            animation: cardAppear 0.5s ease-out forwards;
        }
        
        /* Subtle stagger animation for each card */
        .movie-card:nth-child(1) { animation-delay: 0.4s; }
        .movie-card:nth-child(2) { animation-delay: 0.5s; }
        .movie-card:nth-child(3) { animation-delay: 0.6s; }
        .movie-card:nth-child(4) { animation-delay: 0.7s; }
        .movie-card:nth-child(5) { animation-delay: 0.8s; }
        .movie-card:nth-child(6) { animation-delay: 0.9s; }
        .movie-card:nth-child(n+7) { animation-delay: 1s; }
        
        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Card disappear animation for search filtering */
        .movie-card.hiding {
            animation: cardDisappear 0.3s ease-out forwards;
        }
        
        @keyframes cardDisappear {
            to {
                opacity: 0;
                transform: translateY(-10px) scale(0.98);
            }
        }
        
        .movie-card:hover { 
            box-shadow: 0 10px 35px rgba(221, 31, 37, 0.14); 
            transform: translateY(-4px);
        }
        
        .movie-card:active {
            transform: translateY(-2px);
        }
        
        .movie-image { 
            width: 100%; 
            aspect-ratio: 3/2; 
            object-fit: cover; 
            background: #eaeaea; 
            border-bottom: 1px solid #eee;
            transition: transform 0.35s ease;
        }
        
        .movie-card:hover .movie-image {
            transform: scale(1.04);
        }
        
        .movie-info { 
            padding: 18px 16px 70px 16px; /* Increased bottom padding for more gap */
            flex: 1;
            transition: all 0.25s ease;
            position: relative;
        }

            .movie-year {
                position: absolute;
                bottom: 12px;
                right: 16px;
                background: #DD1F25;
                color: #fff;
                font-size: 0.95rem;
                font-weight: 600;
                padding: 6px 16px;
                border-radius: 16px;
                box-shadow: 0 2px 8px rgba(221, 31, 37, 0.10);
                letter-spacing: 0.5px;
                z-index: 2;
                pointer-events: none;
                opacity: 0.93;
            }
        
        .movie-title { 
            font-size: 1.3rem; 
            font-weight: 700; 
            margin-bottom: 10px; 
            color: #DD1F25; 
            letter-spacing: 0.5px;
            transition: all 0.25s ease;
        }
        
        .movie-card:hover .movie-title {
            transform: translateX(3px);
            color: #AA151B;
        }
        
        .movie-intro { 
            font-size: 1rem; 
            color: #444; 
            opacity: 0.9;
            transition: all 0.25s ease;
        }
        
        .movie-card:hover .movie-intro {
            opacity: 1;
        }
        
        /* No results message */
        .no-results {
            grid-column: 1/-1;
            text-align: center;
            padding: 3em 2em;
            color: #DD1F25;
            font-weight: 600;
            font-size: 1.2rem;
            animation: fadeIn 0.4s ease-out;
        }

        /* Overlay base (ensure it's visible when opened) */
        .popup-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.45);
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(1px);
        }
        .popup-overlay.is-open { display: flex !important; }

        .popup-content {
            position: relative;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 18px 60px rgba(0,0,0,0.25);
            overflow-y: auto; /* Enable vertical scrolling */
            max-height: 90vh; /* Limit height to viewport */
            max-width: 700px;
            width: 95%;
        }
        .popup-close {
            position: absolute;
            top: 10px;
            right: 12px;
            width: 36px;
            height: 36px;
            border: none;
            background: #ffffff;
            color: #222;
            border-radius: 50%;
            font-size: 22px;
            line-height: 36px;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(0,0,0,0.16);
            z-index: 10; /* Keep close button on top */
        }

        /* Map card and full-screen map */
        .map-card-wrapper { 
            max-width: 1100px; 
            margin: 18px auto 6px; 
            padding: 0 20px; 
        }
        .map-card-wrapper.is-open {
            max-height: 380px; /* enough for 320px map + paddings */
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transform: translateY(0);
            margin-bottom: 40px; /* Add white space below when open */
        }
        .map-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 28px rgba(0,0,0,0.12);
            overflow: hidden;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            transform-origin: center;
            cursor: zoom-in;
        }

        #mapPreview { width: 100%; height: 320px; }

        .map-popup { 
            width: 96vw; 
            height: 92vh; 
            padding: 0;
            border-radius: 18px; /* Add rounded corners */
            overflow: hidden; /* Clip map to rounded edges */
        }
        #mapFull { 
            width: 100%; 
            height: 100%; 
            border-radius: 0; /* Remove since parent handles it */
        }

        .leaflet-interactive { cursor: pointer; }

        @media (max-width: 600px) { 
            .catalogue-container { padding: 20px 8px; }
            
            /* Make map bigger on mobile */
            .map-card-wrapper { padding: 0 12px; margin-bottom: 12px; }
            .map-card:hover { transform: scale(1.05); } /* Less aggressive hover */
            #mapPreview { height: 280px; } /* Taller on mobile */
            
            .movies-grid {
                gap: 12px;
                grid-template-columns: 1fr;
            }
            .movie-card {
                flex-direction: row;
                min-height: 120px;
                align-items: flex-start;
                padding-bottom: 24px;
            }
            .movie-image {
                width: 100px;
                height: 100px;
                aspect-ratio: 1/1;
                border-radius: 12px;
                border-bottom: none;
                flex-shrink: 0;
                margin: 12px;
            }
            .movie-info { 
                padding: 12px 12px 60px 12px; /* More bottom padding for topics */
                flex: 1;
                min-width: 0;
            }
            .movie-title {
                font-size: 1.1rem;
                margin-bottom: 6px;
            }
            .movie-intro {
                font-size: 0.9rem;
            }
            .movie-topics {
                position: absolute;
                bottom: 10px;
                left: 120px; /* Place topics under text, not image */
                right: auto;
                flex-wrap: wrap;
                gap: 6px;
            }
            .movie-topic {
                font-size: 0.85rem;
                padding: 5px 10px;
                border-radius: 12px;
                margin-bottom: 2px;
            }
            .navbar { font-size: 1.2rem; padding: 0 20px; }
        }

    /* Add styles for movie topics badge */
    .movie-topics {
        position: absolute;
        bottom: 12px;
        right: 16px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        z-index: 2;
    }
    .movie-topic {
        background: #DD1F25;
        color: #fff;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 6px 14px;
        border-radius: 14px;
        box-shadow: 0 2px 8px rgba(221, 31, 37, 0.10);
        letter-spacing: 0.5px;
        opacity: 0.93;
        pointer-events: none;
        margin-bottom: 2px;
    }

    /* Add hover effect for button */
    #showMapBtn:hover {
        background: #AA151B;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(221, 31, 37, 0.3);
    }
    #showMapBtn:active {
        transform: translateY(0);
    }

    /* Adjust map card wrapper */
    .map-card-wrapper {
        animation: fadeIn 0.4s ease-out;
    }

    /* Map preview appear/disappear animation */
.map-card-wrapper {
    max-width: 1100px;
    margin: 18px auto 6px;
    padding: 0 20px;
    /* hidden by default, will be animated */
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateY(-6px);
    transition: max-height 350ms ease, opacity 250ms ease, transform 250ms ease;
    will-change: max-height, opacity, transform;
}
.map-card-wrapper.is-open {
    max-height: 380px; /* enough for 320px map + paddings */
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateY(0);
    margin-bottom: 40px; /* Add white space below when open */
}
@media (max-width: 600px) {
    .map-card-wrapper { padding: 0 12px; margin-bottom: 12px; }
    .map-card-wrapper.is-open { max-height: 330px; }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
    .map-card-wrapper {
        transition: none;
        transform: none;
    }
}
    </style>
</head>
<body>
    <div class="navbar">
        <a href="general-resources.html">‚Üê Back</a>
        <span class="navbar-title">Spanish general resources</span>
    </div>

    <div class="catalogue-container">
        <div class="search-filter-container">
            <input type="text" class="search-bar" id="searchInput" placeholder="Search resources...">
            <div class="topic-filters">
                <label class="topic-filter-label">
                    <input type="checkbox" value="Movies"> Movies
                </label>
                <label class="topic-filter-label">
                    <input type="checkbox" value="Documentaries"> Documentaries
                </label>
                <label class="topic-filter-label">
                    <input type="checkbox" value="Locations"> Locations
                </label>
            </div>
            <!-- Show Map Button -->
            <button id="showMapBtn" style="
                padding: 12px 28px;
                font-size: 1.05rem;
                font-weight: 600;
                color: #fff;
                background: #DD1F25;
                border: none;
                border-radius: 30px;
                cursor: pointer;
                box-shadow: 0 4px 16px rgba(221, 31, 37, 0.2);
                transition: all 0.25s ease;
                margin-top: 10px;
            ">
                üó∫Ô∏è Show Map
            </button>
        </div>

        <!-- Map card (hidden by default) -->
        <div class="map-card-wrapper" id="mapCardWrapper">
            <div class="map-card" id="mapCard" aria-label="Click to enlarge map">
                <div id="mapPreview"></div>
            </div>
        </div>

        <div class="movies-grid" id="moviesGrid"></div>
    </div>

    <!-- Existing Popup Overlay -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content" id="popupContent">
            <button class="popup-close" id="popupClose">&times;</button>
            <!-- Content will be injected here -->
        </div>
    </div>

    <!-- Full-screen Map Overlay -->
    <div class="popup-overlay" id="mapOverlay">
        <div class="popup-content map-popup">
            <button class="popup-close" id="mapOverlayClose" title="Close map">&times;</button>
            <div id="mapFull"></div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
    /* ===================== Festivals map ===================== */
    const festivalsMapData = [
        { name: "La Tomatina (Bu√±ol)",   lat: 39.4202, lng: -0.7890, url: "../SpanishCulturePages/LaTomatina/index.html" },
        { name: "Las Fallas (Valencia)", lat: 39.4699, lng: -0.3763, url: "../SpanishCulturePages/LasFallas/index.html" },
        { name: "El D√≠a de los Muertos (Mexico City)", lat: 19.4326, lng: -99.1332, url: "../SpanishCulturePages/DayOfTheDead/index.html" },
        { name: "Flamenco (Seville)",    lat: 37.3891, lng: -5.9845, url: "../SpanishCulturePages/Flamenco/index.html" },
        { name: "San Ferm√≠n (Pamplona)", lat: 42.8169, lng: -1.6432, url: "../SpanishCulturePages/SanFermin/index.html" },
        { name: "Semana Santa (M√°laga)", lat: 36.7213, lng: -4.4214, url: "../SpanishCulturePages/SemanaSanta/index.html" },
    ];

    let previewMap, fullMap, previewMarkers = [], fullMarkers = [];
    let mapInitialized = false;

    // Spain bounds (mainland + Balearics)
    const SPAIN_BOUNDS = L.latLngBounds([35.5, -9.5], [43.8, 4.3]);

    function markerStyle(map) {
        const z = map.getZoom() ?? 6;
        const radius = Math.max(5, Math.min(10, 5 + (z - 6) * 1.2));
        return { radius, fillColor: 'crimson', color: '#fff', weight: 2, opacity: 1, fillOpacity: 0.95 };
    }

    function addFestivalMarkers(map, collection) {
        const style = markerStyle(map);
        const list = festivalsMapData.map(f => {
            const m = L.circleMarker([f.lat, f.lng], style)
                .bindTooltip(f.name, { direction: 'top', offset: [0, -8], permanent: false })
                .on('click', () => {
                    if (f.url !== '#') window.open(f.url, '_blank');
                })
                .addTo(map);
            return m;
        });
        map.on('zoomend', () => {
            const st = markerStyle(map);
            list.forEach(m => m.setStyle(st));
        });
        
        // Add map click handler to find and show nearest festival
        map.on('click', (e) => {
            const clickLatLng = e.latlng;
            let nearestFestival = null;
            let minDistance = Infinity;
            
            festivalsMapData.forEach(f => {
                const festivalLatLng = L.latLng(f.lat, f.lng);
                const distance = clickLatLng.distanceTo(festivalLatLng);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestFestival = f;
                }
            });
            
            if (nearestFestival) {
                // Show popup at the nearest festival location
                L.popup()
                    .setLatLng([nearestFestival.lat, nearestFestival.lng])
                    .setContent(`<strong>${nearestFestival.name}</strong><br>${nearestFestival.url !== '#' ? '<a href="' + nearestFestival.url + '" target="_blank">Learn more</a>' : ''}`)
                    .openOn(map);
            }
        });
        
        if (collection) collection.push(...list);
        return list;
    }

    function initMapPreview() {
        previewMap = L.map('mapPreview', {
            zoomControl: false,
            attributionControl: false,
            dragging: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false,
            tap: false,
            minZoom: 5,
            maxZoom: 8,
            worldCopyJump: false
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            noWrap: false
        }).addTo(previewMap);

        previewMap.fitBounds(SPAIN_BOUNDS, { padding: [20, 20] });
        addFestivalMarkers(previewMap, previewMarkers);
        
        setTimeout(() => previewMap.invalidateSize(), 100);
        document.getElementById('mapCard').addEventListener('click', openFullMap);
    }

    function openFullMap() {
        const overlay = document.getElementById('mapOverlay');
        overlay.classList.add('is-open');
        document.body.style.overflow = 'hidden';

        const content = overlay.querySelector('.popup-content');
        content.addEventListener('click', (e) => e.stopPropagation());

        if (!fullMap) {
            fullMap = L.map('mapFull', { 
                zoomControl: true,
                minZoom: 3,
                maxZoom: 12,
                worldCopyJump: true,
                maxBounds: null
            });
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                noWrap: false,
                attribution: '¬© OpenStreetMap'
            }).addTo(fullMap);

            fullMap.fitBounds(SPAIN_BOUNDS, { padding: [30, 30] });
            addFestivalMarkers(fullMap, fullMarkers);
        }

        setTimeout(() => fullMap.invalidateSize(), 100);
        document.addEventListener('keydown', escCloseHandler);
    }

    function escCloseHandler(e) {
        if (e.key === 'Escape') closeFullMap();
    }

    function closeFullMap() {
        const overlay = document.getElementById('mapOverlay');
        overlay.classList.remove('is-open');
        document.body.style.overflow = '';
        document.removeEventListener('keydown', escCloseHandler);
    }

    // Initialize when DOM loads - SINGLE event listener
    document.addEventListener('DOMContentLoaded', () => {
    const showMapBtn = document.getElementById('showMapBtn');
    const mapCardWrapper = document.getElementById('mapCardWrapper');

    // Ensure wrapper participates in layout; visibility controlled by CSS
    mapCardWrapper.style.display = 'block';

    // Show/hide map button handler
    showMapBtn.addEventListener('click', () => {
        const opening = !mapCardWrapper.classList.contains('is-open');
        
        if (opening) {
            // Opening: add class immediately
            mapCardWrapper.classList.add('is-open');
            showMapBtn.textContent = 'üó∫Ô∏è Hide Map';
            
            // Give the wrapper a moment to expand before sizing the map
            if (!mapInitialized) {
                setTimeout(() => {
                    initMapPreview();
                    mapInitialized = true;
                }, 200);
            } else {
                setTimeout(() => previewMap.invalidateSize(), 300);
            }
        } else {
            // Closing: remove class to trigger animation
            mapCardWrapper.classList.remove('is-open');
            showMapBtn.textContent = 'üó∫Ô∏è Show Map';
        }
    });

    // Full map overlay handlers
    document.getElementById('mapOverlayClose').addEventListener('click', closeFullMap);
    document.getElementById('mapOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'mapOverlay') closeFullMap();
    });
    });

    /* ===================== Existing catalogue script ===================== */
    // Resource data with popup content for each card
    const movies = [
        {
            title: "Street food; Latinoam√©rica",
            intro: "Common culture, food...",
            image: "GeneralResources/Spanish/StreetFood/StreetFood1.png",
            topics: ["Movies", "Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/StreetFood/StreetFood1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                    <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Street Food: Latinoam√©rica</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                    <img src="GeneralResources/Spanish/StreetFood/StreetFood3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.1rem;color:#1a1a1a;">Street Food: Latinoam√©rica is a fun and mouth-watering Netflix series that takes you on a trip across different countries in Latin America.<br><br>In each episode, you meet amazing street food cooks who share their tasty dishes and the stories behind them.<br><br>From spicy snacks in Mexico to sweet treats in Argentina, you‚Äôll discover how food connects people, culture, and tradition. It‚Äôs perfect if you love trying new foods or learning about different places!</span>
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.05rem;"><a href="https://www.netflix.com/search?q=Street%20food%3A&jbv=81249660" target="_blank">Street food: Latin America on Netflix</a></span>
                    </div>
                    <img src="GeneralResources/Spanish/StreetFood/StreetFood4.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                </div>
            `
        },
        {
            title: "Coco",
            intro: "Celebrating family and music...",
            image: "GeneralResources/Spanish/Coco/Coco3.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/Coco/Coco1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                    <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Coco</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                    <img src="GeneralResources/Spanish/Coco/Coco3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.1rem;color:#1a1a1a;">Despite his family's generations-old ban on music, young Miguel dreams of becoming an accomplished musician like his idol Ernesto de la Cruz.<br><br>Desperate to prove his talent, Miguel finds himself in the stunning and colorful Land of the Dead.<br><br>After meeting a charming trickster named H√©ctor, the two new friends embark on an extraordinary journey to unlock the real story behind Miguel's family history.</span>
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.05rem;"><a href="https://www.disneyplus.com/en-gb/browse/entity-ce1ccdca-f468-4960-b67c-026b01ba42ab" target="_blank">Watch Coco on Disney Plus</a></span>
                    </div>
                    <img src="GeneralResources/Spanish/Coco/Coco2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                </div>
            `
        },
        {
            title: "La casa de papel: El fen√≥meno",
            intro: "A true version of events...",
            image: "GeneralResources/Spanish/LaCasaDePapelElFen√≥meno/LaCasaDePapelElFen√≥meno1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/LaCasaDePapelElFen√≥meno/LaCasaDePapelElFen√≥meno2.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                    <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">La casa de papel: El fen√≥meno</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                    <img src="GeneralResources/Spanish/LaCasaDePapelElFen√≥meno/LaCasaDePapelElFen√≥meno3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.1rem;color:#1a1a1a;">Money Heist: The Phenomenon (La casa de papel: El fen√≥meno) is a 2020 documentary that explores the global success of the Spanish series Money Heist.</span>
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81098822" target="_blank">Watch La casa de papel: El fen√≥meno on Netflix</a></span>
                    </div>
                    <img src="GeneralResources/Spanish/LaCasaDePapelElFen√≥meno/LaCasaDePapelElFen√≥meno1.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                </div>
            `
        },
        {
            title: "Lorena, la de pies ligeros",
            intro: "A display of endurance, community and tradition...",
            image: "GeneralResources/Spanish/LorenaLaDePiesLigeros/LorenaLaDePiesLigeros1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/LorenaLaDePiesLigeros/LorenaLaDePiesLigeros2.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                    <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Lorena, la de pies ligeros</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                    <img src="GeneralResources/Spanish/LorenaLaDePiesLigeros/LorenaLaDePiesLigeros3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.1rem;color:#1a1a1a;">Lorena Ram√≠rez quietly accepts her fame as an ultra-marathon athlete who regularly out-paces her competitors. Part of Mexico's Rar√°muri community, Lorena blazes through 65 to 95 kilometre runs wearing her traditional sandals.</span>
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/80244683" target="_blank">Watch Lorena, la de pies ligeros on Netflix</a></span>
                    </div>
                    <img src="GeneralResources/Spanish/LorenaLaDePiesLigeros/LorenaLaDePiesLigeros1.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                </div>
            `
        },
        {
            title: "Andes M√°gicos",
            intro: "An amazing journey through the Andes...",
            image: "GeneralResources/Spanish/AndesM√°gicos/AndesM√°gicos1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/AndesM√°gicos/AndesM√°gicos2.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                    <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Andes M√°gicos</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                    <img src="GeneralResources/Spanish/AndesM√°gicos/AndesM√°gicos3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.1rem;color:#1a1a1a;">Andes M√°gicos (Magical Andes) is a 6-part Netflix documentary series that follows individuals connected to the Andes mountain range across Argentina, Chile, Bolivia, Peru, Ecuador, and Colombia.<br><br>The series, created by Luis Ara and Alexandra Hardorf, explores the diverse cultures and landscapes of the mountains by showcasing personal stories of people living and working in this unique environment</span>
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81154549" target="_blank">Watch Andes M√°gicos on Netflix</a></span>
                    </div>
                    <img src="GeneralResources/Spanish/AndesM√°gicos/AndesM√°gicos1.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Movie illustration">
                </div>
            `
        },
        {
            title: "Break It All: The History of Rock in Latin America",
            intro: "Music, rebellion and identity across Latin America",
            image: "GeneralResources/Spanish/BreakItAll/BreakItAll1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/BreakItAll/BreakItAll1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Break It All: The History of Rock in Latin America</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/BreakItAll/BreakItAll2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rock history illustration">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    This series explores five decades of rock movements across Latin America, showing how music intersects with politics, culture and resistance.
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81006953" target="_blank">Watch Break It All on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/BreakItAll/BreakItAll3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rock history illustration">
                </div>
            `
        },
        {
            title: "Parch√≠s: the Documentary",
            intro: "A nostalgic look at one of Spain‚Äôs iconic 80s children‚Äôs music groups",
            image: "GeneralResources/Spanish/Parch√≠s/Parchis1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/Parch√≠s/Parchis1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Parch√≠s: the Documentary</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/Parch√≠s/Parchis2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Parchis illustration">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    The story of Parch√≠s, a children‚Äôs music phenomenon in Spain in the 1980s, and its impact on pop culture and society.
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81036520" target="_blank">Watch Parch√≠s: the Documentary on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/Parch√≠s/Parchis3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Parchis illustration">
                </div>
            `
        },
        {
            title: "Birders",
            intro: "Migration, nature and borderland ecosystems",
            image: "GeneralResources/Spanish/Birders/Birders1.png",
            topics: ["Documentaries"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/Birders/Birders1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Birders</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/Birders/Birders2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Bird migration illustration">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    A short documentary following bird migration across the US‚ÄìMexico border, and how ecosystems connect both sides.
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/80244682" target="_blank">Watch Birders on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/Birders/Birders3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Bird migration illustration">
                </div>
            `
        },
        {
            title: "Love at First Kiss (Eres t√∫)",
            intro: "When a first kiss reveals destiny‚Ä¶",
            image: "GeneralResources/Spanish/LoveAtFirstKiss/LoveAtFirstKiss1.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/LoveAtFirstKiss/LoveAtFirstKiss1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Love at First Kiss</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/LoveAtFirstKiss/LoveAtFirstKiss2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rom-com scene">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    Javier has a unique gift: ever since his first kiss at 16, he realizes when a kiss will be with ‚Äúthe one‚Äù. Romantic, funny and full of surprises.  
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81259655" target="_blank">Watch Love at First Kiss on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/LoveAtFirstKiss/LoveAtFirstKiss3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rom-com scene">
                </div>
            `
        },
        {
            title: "Sounds Like Love (Fuimos canciones)",
            intro: "Friendship, heartbreak & Madrid vibes",
            image: "GeneralResources/Spanish/SoundsLikeLove/SoundsLikeLove1.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/SoundsLikeLove/SoundsLikeLove1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Sounds Like Love</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/SoundsLikeLove/SoundsLikeLove2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rom-com scene">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    Maca‚Äôs life is full of ups and downs: a stressful job, her ex showing up, and two best friends by her side. When past and present collide, things get messy‚Ä¶ and real.  
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81046937" target="_blank">Watch Sounds Like Love on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/SoundsLikeLove/SoundsLikeLove3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Rom-com scene">
                </div>
            `
        },
        {
            title: "1000 Miles from Christmas (A mil kil√≥metros de la Navidad)",
            intro: "Christmas, love & cozy villages",
            image: "GeneralResources/Spanish/1000MilesFromChristmas/1000MilesFromChristmas1.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/1000MilesFromChristmas/1000MilesFromChristmas1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">1000 Miles from Christmas</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/1000MilesFromChristmas/1000MilesFromChristmas2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Holiday village scene">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    A big city guy with zero love for Christmas is sent to a remote village to audit a turr√≥n factory-and ends up sharing a roof (and adventures) with the local schoolteacher who‚Äôs all Christmas spirit. Food, snow, romance, and cozy feels.  
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81244214" target="_blank">Watch 1000 Miles from Christmas on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/1000MilesFromChristmas/1000MilesFromChristmas3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Holiday village scene">
                </div>
            `
        },
        {
            title: "Love, Divided (Pared con pared)",
            intro: "Neighbors separated by a wall‚Ä¶ but maybe not in heart",
            image: "GeneralResources/Spanish/LoveDivided/LoveDivided1.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/LoveDivided/LoveDivided1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">Love, Divided</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/LoveDivided/LoveDivided2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Meet cute scene">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    She plays the piano. He‚Äôs a reclusive inventor. They can‚Äôt stand the noise from each other‚Äôs apartments-but maybe, through the wall, love finds its way.  
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81499999" target="_blank">Watch Love, Divided on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/LoveDivided/LoveDivided3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Meet cute scene">
                </div>
            `
        },
        {
            title: "You've Got This",
            intro: "Family, career and big life moments‚Ä¶ with laughter",
            image: "GeneralResources/Spanish/YouveGotThis/YouveGotThis1.png",
            topics: ["Movies"],
            popup: `
                <div class="hero-banner" style="height:220px;background-image:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)),url('GeneralResources/Spanish/YouveGotThis/YouveGotThis1.png');background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;margin-bottom:30px;">
                <h1 style="font-family:'Palatino Linotype',serif;font-size:2.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.4);text-align:center;">You've Got This</h1>
                </div>
                <div style="max-width:600px;margin:0 auto;padding:10px 20px 30px 20px;">
                <img src="GeneralResources/Spanish/YouveGotThis/YouveGotThis2.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Family moments scene">
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.1rem;color:#1a1a1a;">
                    A loving but overworked exec wants to be more than just successful-she wants a family too. When life gets chaotic, she learns what really matters (with lots of laughs).  
                    </span>
                </div>
                <div style="margin-bottom:1.5em;">
                    <span style="font-size:1.05rem;"><a href="https://www.netflix.com/title/81050943" target="_blank">Watch You've Got This on Netflix</a></span>
                </div>
                <img src="GeneralResources/Spanish/YouveGotThis/YouveGotThis3.png" style="display:block;margin:2em auto;max-width:100%;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.12);" alt="Family moments scene">
                </div>
            `
        }
    ];  

    function normalizeText(text) {
        return text ? text.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase() : '';
    }

    function getSelectedTopics() {
        const checkboxes = document.querySelectorAll('.topic-filters input[type="checkbox"]');
        const selected = [];
        checkboxes.forEach(cb => {
            if (cb.checked) {
                selected.push(cb.value);
            }
        });
        return selected;
    }

    function renderMoviesCatalogue(filter='') {
        const grid = document.getElementById('moviesGrid');
        const normalizedFilter = normalizeText(filter);
        const selectedTopics = getSelectedTopics();

        let shown = 0;
        let newHTML = '';
        movies.forEach((movie, index) => {
            const matchesFilter = !normalizedFilter ||
                normalizeText(movie.title).includes(normalizedFilter) ||
                normalizeText(movie.intro).includes(normalizedFilter);
            const matchesTopics = selectedTopics.length === 0 ||
                selectedTopics.some(topic => movie.topics.includes(topic));

            if (matchesFilter && matchesTopics) {
                shown++;
                newHTML += `
                    <div class="movie-card" tabindex="0" data-index="${index}" style="animation-delay:${0.05 * index}s;position:relative;">
                        <img src="${movie.image}" alt="${movie.title}" class="movie-image">
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-intro">${movie.intro}</div>
                        </div>
                        <div class="movie-topics">
                            ${movie.topics.map(topic => `<span class="movie-topic">${topic}</span>`).join(' ')}
                        </div>
                    </div>`;
            }
        });

        if (shown === 0) {
            newHTML = `<div class="no-results">No resources found.</div>`;
        }

        grid.innerHTML = newHTML;

        // Add click event listeners for popups
        document.querySelectorAll('.movie-card').forEach(card => {
            card.onclick = function() {
                const idx = this.getAttribute('data-index');
                showPopup(movies[idx].popup);
            };
            card.onkeydown = function(e) {
                if (e.key === "Enter" || e.key === " ") {
                    const idx = this.getAttribute('data-index');
                    showPopup(movies[idx].popup);
                }
            };
        });
    }

    function showPopup(html) {
        const overlay = document.getElementById('popupOverlay');
        const content = document.getElementById('popupContent');
        content.querySelector('.popup-close').onclick = hidePopup;
        content.innerHTML = `<button class="popup-close" id="popupClose">&times;</button>` + html;
        overlay.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        document.getElementById('popupClose').onclick = hidePopup;
        overlay.onclick = function(e) {
            if (e.target === overlay) hidePopup();
        };
        document.onkeydown = function(e) {
            if (e.key === "Escape") hidePopup();
        };
    }

    function hidePopup() {
        document.getElementById('popupOverlay').style.display = 'none';
        document.body.style.overflow = '';
        document.onkeydown = null;
    }

    renderMoviesCatalogue();

    document.getElementById('searchInput').addEventListener('input', function() {
        renderMoviesCatalogue(this.value);
    });

    const topicCheckboxes = document.querySelectorAll('.topic-filters input[type="checkbox"]');
    topicCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            this.parentElement.classList.toggle('active', this.checked);
            const searchValue = document.getElementById('searchInput').value;
            renderMoviesCatalogue(searchValue);
        });
        if (checkbox.checked) {
            checkbox.parentElement.classList.add('active');
        }
    });
    </script>
</body>
</html>